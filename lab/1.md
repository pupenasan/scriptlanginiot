[Лабораторні](README.md)

# ЛАБОРАТОРНА РОБОТА № 1. Використання JS для програмування IoT пристроїв 

Увага! Усі наведені в лабораторній роботі приклади передбачають, що здобувач буде розбиратися з їх функціонуванням.

## Знайомство з makecode.microbit

https://makecode.microbit.org/

Середовище Microsoft MakeCode — це безкоштовна онлайн-платформа для навчання коду, на якій кожен може створювати ігри, кодувати пристрої та модифікувати Minecraft. Microsoft MakeCode базується на проекті з відкритим кодом ([PXT](https://github.com/microsoft/pxt)) 

### 1. Реєстрація в microbit.org та створення першого проекту

- [ ] Зайдіть на сайт https://makecode.microbit.org/

- [ ] Натисніть кнопку "Увійти" і зареєструйтеся в системі
- [ ] Натисніть "Новий проект" і створіть проект з іменем `proect_вашепрізвище` де замість `вашепрізвище` вкажіть ваш прізвище латиною.
- [ ] Після створення проекту перший раз Вам запропонують помічник який познайомить Вас з основними інструментами середовища розроблення 
- [ ] Перейдіть на закладку `JavaScript`, надалі передбачається розробляти скрипти саме на цій мові
- [ ]  Подивіться на структуру коду, за замовченням та є одна функція, вірніше метод `forever` об'єкту `basic` який викликається циклічно 

![image-20240101105236654](media1/image-20240101105236654.png)

Ліворуч від коду є панель з блоками, в яких можна вибрати конкретний метод і перетягнути в програму.

- [ ] Виберіть блок `Основні -> Пказати рядок` і перетягніть в свою програму.   

![image-20240111223559019](media1/image-20240111223559019.png)

Повинна вийти така програма

```js
basic.forever(function () {
    basic.showString("Hello!")
})
```

- [ ] Натисніть на `Запустити симулятор` і подивіться на результат

![image-20240111194825182](media1/image-20240111194825182.png)

### 2. Використання імітатора програми та налагоджувальних засобів

У онлайн середовище розроблення вбудований симулятор ПЛК. Тому логіку виконання програм можна відлагоджувати на цьому емуляторі.

- [ ] Запишіть наступний код

```typescript
let count = 0;
basic.forever(function () {
    count += 1;
    console.log (count)
})
```

- [ ] Натисніть на `Запустити симулятор`

- [ ] Відкрийте дані для симулятора

![image-20240111195108148](media1/image-20240111195108148.png)

Ви побачите що потік даних відображаються в текстовому вигляді і на діаграмі. Потік зумовено постійним викликом методу `forever`, який забезпечує планувальником `micro:bit`, про це можна почитати деальніше [за посиланням](../add/microbit/README.md). Для того, щоб інші події могли бути оброблені, необхідно ставити паузи.  

![image-20240111195243865](media1/image-20240111195243865.png)

- [ ] Змініть код та перевірте його виконання

```js
let count = 0;
basic.forever(function () {
    count += 1;
    console.log (count);
    basic.pause (500) //ставимо паузу до наступного виклику 500 мс 
})
```

Як бачите, періодичність виклику змінилася. 

Щодо `console.log`, то в даному випадку метод дає можливість виводити дані на консоль з симулятора ПЛК. Однак при підключенні MakeCode до реального обладнання, для отримання даних з плати, дані можна з неї можна відправляти (отримувати на ПК) через методи обєкту послідовного порта  [serial](https://github.com/microsoft/pxt-microbit/blob/master/reference/serial). 

- [ ] Змініть програму на наступну та перевірте її роботу

```js
let count = 0;
basic.forever(function () {
    count += 1;
    serial.writeLine(count.toString());// аналогічно console.log (count);
    basic.pause (500) //ставимо паузу до наступного виклику 500 мс 
})
```

Усі дані, записані з плати функціями [serial](https://github.com/microsoft/pxt-microbit/blob/master/reference/serial), що передаються через USB в ПК в MakeCode записуються редактором MakeCode. Те саме відбувається, коли запускається код в симуляторі. Виведення даних в консолі та на діаграмі залежить від формату запису в послідовний порт. Проексперементуйте кілька варіантів, більш повний опис доступний [за посиланням](https://makecode.microbit.org/device/data-analysis/writing)   

- [ ] Напишіть наступний фрагмент коду, замінивши попередній:

```js
let count = 0;
let arr = [];
basic.forever(function () {
    count += 1;
    arr = [count, count + 10.5, count + 21];
    serial.writeNumbers(arr); // виведення масиву
    basic.pause(500) //ставимо паузу до наступного виклику 500 мс 
})
```

![image-20240111222214734](media1/image-20240111222214734.png)

- [ ] Напишіть наступний фрагмент коду, замінивши попередній:

```js
let count = 0;
let arr = [];
basic.forever(function () {
    count += 1;
    arr = [count, count + 10.5, count + 21];
    serial.writeValue("count", count);
    serial.writeValue("arr[0]", arr[0]);
    basic.pause(500) //ставимо паузу до наступного виклику 500 мс 
})
```

![image-20240111222815131](media1/image-20240111222815131.png)

- [ ] Напишіть наступний фрагмент коду, замінивши попередній:

```js
let count = 0;
basic.forever(function () {
    count += 1;
    serial.writeValue("count.base", count);
    serial.writeValue("count.bias10", count+10);
    serial.writeValue("count.bias20", count+20);
    basic.pause(500) //ставимо паузу до наступного виклику 500 мс 
})
```

![image-20240111223319222](media1/image-20240111223319222.png)

### 3. Робота з входами/виходами micro:bit та масивами

У цьому пункті необхідно потренуватися з блоками з розділів `Вхідні дані` (`inputs`) та `піни` (`pins`). 

- [ ] Познайомтеся з описом апаратного забезпечення micro:bit за [цим посиланням](../add/microbit/device.md)

Є кілька варіантів роботи з входами: 

- встановити обробник входів з передачою функції обробки
- опитувати вхід за необхідності

- [ ] Напишіть і перевірте роботу наступного фрагменту програми

```js
input.onButtonPressed(Button.A, function () {
    // отримати значення піна P1
    let p1 = pins.digitalReadPin(DigitalPin.P1);
    p1 = p1 == 0 ? 1 : 0; // тернарий вираз
    // записати значення піна P1
    pins.digitalWritePin(DigitalPin.P1, p1)
})
```

- [ ] Напишіть і перевірте роботу наступного фрагменту програми

```js
basic.forever(function () {
	let temp = input.temperature();
    serial.writeValue("temperature", temp);
    basic.pause(500);
})
```

![image-20240112104545129](media1/image-20240112104545129.png)

- [ ] Напишіть і перевірте роботу наступного фрагменту програми. Для зміни значення піна в симуляторі натисніть на 4-му піні і мишою змінюйте його значення

```js
basic.forever(function () {
	let p4ai = pins.analogReadPin(AnalogPin.P4)
    serial.writeValue("p4ai", p4ai);
    basic.pause(500);
})
```

![image-20240112105116846](media1/image-20240112105116846.png)

- [ ] Напишіть і перевірте роботу наступного фрагменту програми, який реалізує П-закон регулювання. Для зміни значення завдання (`sp`) використовуйте кнопки більше та менше.

```js
let sp = 500; // задане значення
basic.forever(function () {
    let pv = pins.analogReadPin(AnalogPin.P4);// дійсне значення
    let kp = 2; // коейіцієнт пропорційності
    let out = (sp - pv) * kp + 500; 
    pins.analogWritePin(AnalogPin.P0, out);
    serial.writeValue("loop.pv", pv);
    serial.writeValue("loop.sp", sp);
    serial.writeValue("loop.out", out);
    // збільшення/зменшення завдання по кнопкам 
    if (input.buttonIsPressed(Button.A) === true) {
        sp += 5;
    }
    if (input.buttonIsPressed(Button.B) === true ) {
        sp -= 5;
    }
    basic.pause(500);
})
```

- [ ] Напишіть і перевірте роботу наступного фрагменту програми, який реалізує П-закон регулювання та керує серводвигуном. Для зміни значення завдання (`sp`) використовуйте кнопки більше та менше

```js
let sp = 500; // задане значення
basic.forever(function () {
    let pv =  input.temperature();// дійсне значення
    let kp = 2; // коейіцієнт пропорційності
    let out = (sp - pv) * kp + 500; 
    pins.analogWritePin(AnalogPin.P0, out);
    serial.writeValue("loop.pv", pv);
    serial.writeValue("loop.sp", sp);
    serial.writeValue("loop.out", out);
    // збільшення/зменшення завдання по кнопкам 
    if (input.buttonIsPressed(Button.A) === true) {
        sp += 5;
    }
    if (input.buttonIsPressed(Button.B) === true ) {
        sp -= 5;
    }
    // масштабування 0-1023 => 0-180
    out = Math.map(out, 0, 1023, 0, 180)
    pins.servoWritePin(AnalogPin.P2, out);
    basic.pause(500);
})
```

### 4. Робота з LED

- [ ] Напишіть і перевірте роботу наступного фрагменту програми. 

```js
let direction = 0;
basic.forever(function () {
    direction++;
    if (direction > 7) direction = 0;
    basic.showArrow(direction)
    basic.pause(250);
})
```

- [ ] Напишіть і перевірте роботу наступного фрагменту програми. 

```js
let icons = 0;
basic.forever(function () {
    icons++;
    if (icons > 40) icons = 0;
    basic.showIcon(icons)
    basic.pause(250);
})
```

- [ ] Напишіть і перевірте роботу наступного фрагменту програми. 

```js
basic.showLeds(`
    # . # . #
    . . . . .
    # . # . #
    . . . . .
    # . # . #
    `);
```

- [ ] Напишіть і перевірте роботу наступного фрагменту програми. 

```js
let val = 0;
basic.forever(function () {
    // DigitalPin.P0 - 100
    // DigitalPin.P20 - 120
    val++;
    if (val > 0b11111111111111111111) val = 0;
    for (let i = 0; i<20; i++) {
        let pinnmbr = 100 + i;
        // стан біта по масці
        let mask = 1 << i;
        let bitval = (val & mask) !== 0;
        let y = i/5; 
        let x = i % 5;
        if (bitval) {led.plot(x, y)} else {led.unplot(x, y)}
    }
})
```





## Знайомство з Espruino

https://www.espruino.com/ide/

